import u from"../chunks/form-fields-BxewiIMx.js";import"../chunks/aem-CseYPO2m.js";async function d(e,n){const{pathname:t}=new URL(e),o=await(await fetch(t)).json(),a=document.createElement("form");return a.dataset.action=n,(await Promise.all(o.data.map(s=>u(s,a)))).forEach(s=>{s&&a.append(s)}),a.querySelectorAll("fieldset").forEach(s=>{a.querySelectorAll(`[data-fieldset="${s.name}"`).forEach(l=>{s.append(l)})}),a}function m(e){const n={};return[...e.elements].forEach(t=>{t.name&&t.type!=="submit"&&!t.disabled&&(t.type==="radio"?t.checked&&(n[t.name]=t.value):t.type==="checkbox"?t.checked&&(n[t.name]=n[t.name]?`${n[t.name]},${t.value}`:t.value):n[t.name]=t.value)}),n}async function f(e){if(e.getAttribute("data-submitting")==="true")return;const n=e.querySelector('button[type="submit"]');try{e.setAttribute("data-submitting","true"),n.disabled=!0;const t=m(e),i=await fetch(e.dataset.action,{method:"POST",body:JSON.stringify({data:t}),headers:{"Content-Type":"application/json"}});if(i.ok)e.dataset.confirmation&&(window.location.href=e.dataset.confirmation);else{const o=await i.text();throw new Error(o)}}catch(t){console.error(t)}finally{e.setAttribute("data-submitting","false"),n.disabled=!1}}async function y(e){const n=[...e.querySelectorAll("a")].map(a=>a.href),t=n.find(a=>a.startsWith(window.location.origin)&&a.endsWith(".json")),i=n.find(a=>a!==t);if(!t||!i)return;const o=await d(t,i);e.replaceChildren(o),o.addEventListener("submit",a=>{if(a.preventDefault(),o.checkValidity())f(o);else{const r=o.querySelector(":invalid:not(fieldset)");r&&(r.focus(),r.scrollIntoView({behavior:"smooth"}))}})}export{y as default};
//# sourceMappingURL=form.js.map
