import{f as g,e as x,g as C}from"../chunks/aem-CseYPO2m.js";const u=new URLSearchParams(window.location.search);function L(e){let t=e.parentElement.previousElement||e.parentElement.parentElement,r="H2";for(;t;){const s=[...t.querySelectorAll("h1, h2, h3, h4, h5, h6")].pop();if(s){const n=parseInt(s.nodeName[1],10);r=n<6?`H${n+1}`:"H6",t=!1}else t=t.previousElement||t.parentElement}return r}function f(e,t){t.forEach(r=>{if(!r||!r.textContent)return;const s=[],{textContent:n}=r;if(e.forEach(o=>{let l=0,d=n.toLowerCase().indexOf(o.toLowerCase(),l);for(;d>=0;)s.push({offset:d,term:n.substring(d,d+o.length)}),l=d+o.length,d=n.toLowerCase().indexOf(o.toLowerCase(),l)}),!s.length)return;s.sort((o,l)=>o.offset-l.offset);let a=0;const c=s.reduce((o,{offset:l,term:d})=>{if(l<a)return o;const h=n.substring(a,l);h&&o.appendChild(document.createTextNode(h));const p=document.createElement("mark");return p.textContent=d,o.appendChild(p),a=l+d.length,o},document.createDocumentFragment()),i=n.substring(a);i&&c.appendChild(document.createTextNode(i)),r.innerHTML="",r.appendChild(c)})}async function y(e){const t=await fetch(e);if(!t.ok)return console.error("error loading API response",t),null;const r=await t.json();return r?r.data:(console.error("empty API response",e),null)}function S(e,t,r){const s=document.createElement("li"),n=document.createElement("a");if(n.href=e.path,e.image){const a=document.createElement("div");a.className="search-result-image";const c=C(e.image,"",!1,[{width:"375"}]);a.append(c),n.append(a)}if(e.title){const a=document.createElement(r);a.className="search-result-title";const c=document.createElement("a");c.href=e.path,c.textContent=e.title,f(t,[c]),a.append(c),n.append(a)}if(e.description){const a=document.createElement("p");a.textContent=e.description,f(t,[a]),n.append(a)}return s.append(n),s}function w(e){const t=e.querySelector(".search-results");t.innerHTML=""}function E(e){if(w(e),window.history.replaceState){const t=new URL(window.location.href);t.search="",u.delete("q"),window.history.replaceState({},"",t.toString())}}async function v(e,t,r,s){w(e);const n=e.querySelector(".search-results"),a=n.dataset.h;if(r.length)n.classList.remove("no-results"),r.forEach(c=>{const i=S(c,s,a);n.append(i)});else{const c=document.createElement("li");n.classList.add("no-results"),c.textContent=t.placeholders.searchNoResults||"No results found.",n.append(c)}}function m(e,t){return e.minIdx-t.minIdx}function I(e,t){const r=[],s=[];return t.forEach(n=>{let a=-1;if(e.forEach(i=>{const o=(n.header||n.title).toLowerCase().indexOf(i);o<0||a<o&&(a=o)}),a>=0){r.push({minIdx:a,result:n});return}const c=`${n.title} ${n.description} ${n.path.split("/").pop()}`.toLowerCase();e.forEach(i=>{const o=c.indexOf(i);o<0||a<o&&(a=o)}),a>=0&&s.push({minIdx:a,result:n})}),[...r.sort(m),...s.sort(m)].map(n=>n.result)}async function q(e,t,r){const s=e.target.value;if(u.set("q",s),window.history.replaceState){const i=new URL(window.location.href);i.search=u.toString(),window.history.replaceState({},"",i.toString())}if(s.length<3){E(t);return}const n=s.toLowerCase().split(/\s+/).filter(i=>!!i),a=await y(r.source),c=I(n,a);await v(t,r,c,n)}function R(e){const t=document.createElement("ul");return t.className="search-results",t.dataset.h=L(e),t}function N(e,t){const r=document.createElement("input");r.setAttribute("type","search"),r.className="search-input";const s=t.placeholders.searchPlaceholder||"Search...";return r.placeholder=s,r.setAttribute("aria-label",s),r.addEventListener("input",n=>{q(n,e,t)}),r.addEventListener("keyup",n=>{n.code==="Escape"&&E(e)}),r}function H(){const e=document.createElement("span");return e.classList.add("icon","icon-search"),e}function P(e,t){const r=document.createElement("div");return r.classList.add("search-box"),r.append(H(),N(e,t)),r}async function A(e){const t=await g(),r=e.querySelector("a[href]")?e.querySelector("a[href]").href:"/query-index.json";if(e.innerHTML="",e.append(P(e,{source:r,placeholders:t}),R(e)),u.get("q")){const s=e.querySelector("input");s.value=u.get("q"),s.dispatchEvent(new Event("input"))}x(e)}export{A as default,y as fetchData};
//# sourceMappingURL=search.js.map
