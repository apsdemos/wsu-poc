{"version":3,"file":"carousel.js","sources":["../../src/blocks/carousel/carousel.js"],"sourcesContent":["import { fetchPlaceholders } from '../../scripts/aem.js';\n\nfunction updateActiveSlide(slide) {\n  const block = slide.closest('.carousel');\n  const slideIndex = parseInt(slide.dataset.slideIndex, 10);\n  block.dataset.activeSlide = slideIndex;\n\n  const slides = block.querySelectorAll('.carousel-slide');\n\n  slides.forEach((aSlide, idx) => {\n    aSlide.setAttribute('aria-hidden', idx !== slideIndex);\n    aSlide.querySelectorAll('a').forEach((link) => {\n      if (idx !== slideIndex) {\n        link.setAttribute('tabindex', '-1');\n      } else {\n        link.removeAttribute('tabindex');\n      }\n    });\n  });\n\n  const indicators = block.querySelectorAll('.carousel-slide-indicator');\n  indicators.forEach((indicator, idx) => {\n    if (idx !== slideIndex) {\n      indicator.querySelector('button').removeAttribute('disabled');\n    } else {\n      indicator.querySelector('button').setAttribute('disabled', 'true');\n    }\n  });\n}\n\nexport function showSlide(block, slideIndex = 0) {\n  const slides = block.querySelectorAll('.carousel-slide');\n  let realSlideIndex = slideIndex < 0 ? slides.length - 1 : slideIndex;\n  if (slideIndex >= slides.length) realSlideIndex = 0;\n  const activeSlide = slides[realSlideIndex];\n\n  activeSlide.querySelectorAll('a').forEach((link) => link.removeAttribute('tabindex'));\n  block.querySelector('.carousel-slides').scrollTo({\n    top: 0,\n    left: activeSlide.offsetLeft,\n    behavior: 'smooth',\n  });\n}\n\nfunction bindEvents(block) {\n  const slideIndicators = block.querySelector('.carousel-slide-indicators');\n  if (!slideIndicators) return;\n\n  slideIndicators.querySelectorAll('button').forEach((button) => {\n    button.addEventListener('click', (e) => {\n      const slideIndicator = e.currentTarget.parentElement;\n      showSlide(block, parseInt(slideIndicator.dataset.targetSlide, 10));\n    });\n  });\n\n  block.querySelector('.slide-prev').addEventListener('click', () => {\n    showSlide(block, parseInt(block.dataset.activeSlide, 10) - 1);\n  });\n  block.querySelector('.slide-next').addEventListener('click', () => {\n    showSlide(block, parseInt(block.dataset.activeSlide, 10) + 1);\n  });\n\n  const slideObserver = new IntersectionObserver((entries) => {\n    entries.forEach((entry) => {\n      if (entry.isIntersecting) updateActiveSlide(entry.target);\n    });\n  }, { threshold: 0.5 });\n  block.querySelectorAll('.carousel-slide').forEach((slide) => {\n    slideObserver.observe(slide);\n  });\n}\n\nfunction createSlide(row, slideIndex, carouselId) {\n  const slide = document.createElement('li');\n  slide.dataset.slideIndex = slideIndex;\n  slide.setAttribute('id', `carousel-${carouselId}-slide-${slideIndex}`);\n  slide.classList.add('carousel-slide');\n\n  row.querySelectorAll(':scope > div').forEach((column, colIdx) => {\n    column.classList.add(`carousel-slide-${colIdx === 0 ? 'image' : 'content'}`);\n    slide.append(column);\n  });\n\n  const labeledBy = slide.querySelector('h1, h2, h3, h4, h5, h6');\n  if (labeledBy) {\n    slide.setAttribute('aria-labelledby', labeledBy.getAttribute('id'));\n  }\n\n  return slide;\n}\n\nlet carouselId = 0;\nexport default async function decorate(block) {\n  carouselId += 1;\n  block.setAttribute('id', `carousel-${carouselId}`);\n  const rows = block.querySelectorAll(':scope > div');\n  const isSingleSlide = rows.length < 2;\n\n  const placeholders = await fetchPlaceholders();\n\n  block.setAttribute('role', 'region');\n  block.setAttribute('aria-roledescription', placeholders.carousel || 'Carousel');\n\n  const container = document.createElement('div');\n  container.classList.add('carousel-slides-container');\n\n  const slidesWrapper = document.createElement('ul');\n  slidesWrapper.classList.add('carousel-slides');\n  block.prepend(slidesWrapper);\n\n  let slideIndicators;\n  if (!isSingleSlide) {\n    const slideIndicatorsNav = document.createElement('nav');\n    slideIndicatorsNav.setAttribute('aria-label', placeholders.carouselSlideControls || 'Carousel Slide Controls');\n    slideIndicators = document.createElement('ol');\n    slideIndicators.classList.add('carousel-slide-indicators');\n    slideIndicatorsNav.append(slideIndicators);\n    block.append(slideIndicatorsNav);\n\n    const slideNavButtons = document.createElement('div');\n    slideNavButtons.classList.add('carousel-navigation-buttons');\n    slideNavButtons.innerHTML = `\n      <button type=\"button\" class= \"slide-prev\" aria-label=\"${placeholders.previousSlide || 'Previous Slide'}\"></button>\n      <button type=\"button\" class=\"slide-next\" aria-label=\"${placeholders.nextSlide || 'Next Slide'}\"></button>\n    `;\n\n    container.append(slideNavButtons);\n  }\n\n  rows.forEach((row, idx) => {\n    const slide = createSlide(row, idx, carouselId);\n    slidesWrapper.append(slide);\n\n    if (slideIndicators) {\n      const indicator = document.createElement('li');\n      indicator.classList.add('carousel-slide-indicator');\n      indicator.dataset.targetSlide = idx;\n      indicator.innerHTML = `<button type=\"button\" aria-label=\"${placeholders.showSlide || 'Show Slide'} ${idx + 1} ${placeholders.of || 'of'} ${rows.length}\"></button>`;\n      slideIndicators.append(indicator);\n    }\n    row.remove();\n  });\n\n  container.append(slidesWrapper);\n  block.prepend(container);\n\n  if (!isSingleSlide) {\n    bindEvents(block);\n  }\n}\n"],"names":["updateActiveSlide","slide","block","slideIndex","aSlide","idx","link","indicator","showSlide","slides","realSlideIndex","activeSlide","bindEvents","slideIndicators","button","e","slideIndicator","slideObserver","entries","entry","createSlide","row","carouselId","column","colIdx","labeledBy","decorate","rows","isSingleSlide","placeholders","fetchPlaceholders","container","slidesWrapper","slideIndicatorsNav","slideNavButtons"],"mappings":"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"}