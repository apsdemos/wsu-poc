{"version":3,"file":"form-fields-BxewiIMx.js","sources":["../../src/blocks/form/form-fields.js"],"sourcesContent":["import { toClassName } from '../../scripts/aem.js';\n\nfunction createFieldWrapper(fd) {\n  const fieldWrapper = document.createElement('div');\n  if (fd.Style) fieldWrapper.className = fd.Style;\n  fieldWrapper.classList.add('field-wrapper', `${fd.Type}-wrapper`);\n\n  fieldWrapper.dataset.fieldset = fd.Fieldset;\n\n  return fieldWrapper;\n}\n\nconst ids = [];\nfunction generateFieldId(fd, suffix = '') {\n  const slug = toClassName(`form-${fd.Name}${suffix}`);\n  ids[slug] = ids[slug] || 0;\n  const idSuffix = ids[slug] ? `-${ids[slug]}` : '';\n  ids[slug] += 1;\n  return `${slug}${idSuffix}`;\n}\n\nfunction createLabel(fd) {\n  const label = document.createElement('label');\n  label.id = generateFieldId(fd, '-label');\n  label.textContent = fd.Label || fd.Name;\n  label.setAttribute('for', fd.Id);\n  if (fd.Mandatory.toLowerCase() === 'true' || fd.Mandatory.toLowerCase() === 'x') {\n    label.dataset.required = true;\n  }\n  return label;\n}\n\nfunction setCommonAttributes(field, fd) {\n  field.id = fd.Id;\n  field.name = fd.Name;\n  field.required = fd.Mandatory && (fd.Mandatory.toLowerCase() === 'true' || fd.Mandatory.toLowerCase() === 'x');\n  field.placeholder = fd.Placeholder;\n  field.value = fd.Value;\n}\n\nconst createHeading = (fd) => {\n  const fieldWrapper = createFieldWrapper(fd);\n\n  const level = fd.Style && fd.Style.includes('sub-heading') ? 3 : 2;\n  const heading = document.createElement(`h${level}`);\n  heading.textContent = fd.Value || fd.Label;\n  heading.id = fd.Id;\n\n  fieldWrapper.append(heading);\n\n  return { field: heading, fieldWrapper };\n};\n\nconst createPlaintext = (fd) => {\n  const fieldWrapper = createFieldWrapper(fd);\n\n  const text = document.createElement('p');\n  text.textContent = fd.Value || fd.Label;\n  text.id = fd.Id;\n\n  fieldWrapper.append(text);\n\n  return { field: text, fieldWrapper };\n};\n\nconst createSelect = async (fd) => {\n  const select = document.createElement('select');\n  setCommonAttributes(select, fd);\n  const addOption = ({ text, value }) => {\n    const option = document.createElement('option');\n    option.text = text.trim();\n    option.value = value.trim();\n    if (option.value === select.value) {\n      option.setAttribute('selected', '');\n    }\n    select.add(option);\n    return option;\n  };\n\n  if (fd.Placeholder) {\n    const ph = addOption({ text: fd.Placeholder, value: '' });\n    ph.setAttribute('disabled', '');\n  }\n\n  if (fd.Options) {\n    let options = [];\n    if (fd.Options.startsWith('https://')) {\n      const optionsUrl = new URL(fd.Options);\n      const resp = await fetch(`${optionsUrl.pathname}${optionsUrl.search}`);\n      const json = await resp.json();\n      json.data.forEach((opt) => {\n        options.push({\n          text: opt.Option,\n          value: opt.Value || opt.Option,\n        });\n      });\n    } else {\n      options = fd.Options.split(',').map((opt) => ({\n        text: opt.trim(),\n        value: opt.trim().toLowerCase(),\n      }));\n    }\n\n    options.forEach((opt) => addOption(opt));\n  }\n\n  const fieldWrapper = createFieldWrapper(fd);\n  fieldWrapper.append(select);\n  fieldWrapper.prepend(createLabel(fd));\n\n  return { field: select, fieldWrapper };\n};\n\nconst createConfirmation = (fd, form) => {\n  form.dataset.confirmation = new URL(fd.Value).pathname;\n\n  return {};\n};\n\nconst createSubmit = (fd) => {\n  const button = document.createElement('button');\n  button.textContent = fd.Label || fd.Name;\n  button.classList.add('button');\n  button.type = 'submit';\n\n  const fieldWrapper = createFieldWrapper(fd);\n  fieldWrapper.append(button);\n  return { field: button, fieldWrapper };\n};\n\nconst createTextArea = (fd) => {\n  const field = document.createElement('textarea');\n  setCommonAttributes(field, fd);\n\n  const fieldWrapper = createFieldWrapper(fd);\n  const label = createLabel(fd);\n  field.setAttribute('aria-labelledby', label.id);\n  fieldWrapper.append(field);\n  fieldWrapper.prepend(label);\n\n  return { field, fieldWrapper };\n};\n\nconst createInput = (fd) => {\n  const field = document.createElement('input');\n  field.type = fd.Type;\n  setCommonAttributes(field, fd);\n\n  const fieldWrapper = createFieldWrapper(fd);\n  const label = createLabel(fd);\n  field.setAttribute('aria-labelledby', label.id);\n  fieldWrapper.append(field);\n  if (fd.Type === 'radio' || fd.Type === 'checkbox') {\n    fieldWrapper.append(label);\n  } else {\n    fieldWrapper.prepend(label);\n  }\n\n  return { field, fieldWrapper };\n};\n\nconst createFieldset = (fd) => {\n  const field = document.createElement('fieldset');\n  setCommonAttributes(field, fd);\n\n  if (fd.Label) {\n    const legend = document.createElement('legend');\n    legend.textContent = fd.Label;\n    field.append(legend);\n  }\n\n  const fieldWrapper = createFieldWrapper(fd);\n  fieldWrapper.append(field);\n\n  return { field, fieldWrapper };\n};\n\nconst createToggle = (fd) => {\n  const { field, fieldWrapper } = createInput(fd);\n  field.type = 'checkbox';\n  if (!field.value) field.value = 'on';\n  field.classList.add('toggle');\n  fieldWrapper.classList.add('selection-wrapper');\n\n  const toggleSwitch = document.createElement('div');\n  toggleSwitch.classList.add('switch');\n  toggleSwitch.append(field);\n  fieldWrapper.append(toggleSwitch);\n\n  const slider = document.createElement('span');\n  slider.classList.add('slider');\n  toggleSwitch.append(slider);\n  slider.addEventListener('click', () => {\n    field.checked = !field.checked;\n  });\n\n  return { field, fieldWrapper };\n};\n\nconst createCheckbox = (fd) => {\n  const { field, fieldWrapper } = createInput(fd);\n  if (!field.value) field.value = 'checked';\n  fieldWrapper.classList.add('selection-wrapper');\n\n  return { field, fieldWrapper };\n};\n\nconst createRadio = (fd) => {\n  const { field, fieldWrapper } = createInput(fd);\n  if (!field.value) field.value = fd.Label || 'on';\n  fieldWrapper.classList.add('selection-wrapper');\n\n  return { field, fieldWrapper };\n};\n\nconst FIELD_CREATOR_FUNCTIONS = {\n  select: createSelect,\n  heading: createHeading,\n  plaintext: createPlaintext,\n  'text-area': createTextArea,\n  toggle: createToggle,\n  submit: createSubmit,\n  confirmation: createConfirmation,\n  fieldset: createFieldset,\n  checkbox: createCheckbox,\n  radio: createRadio,\n};\n\nexport default async function createField(fd, form) {\n  fd.Id = fd.Id || generateFieldId(fd);\n  const type = fd.Type.toLowerCase();\n  const createFieldFunc = FIELD_CREATOR_FUNCTIONS[type] || createInput;\n  const fieldElements = await createFieldFunc(fd, form);\n\n  return fieldElements.fieldWrapper;\n}\n"],"names":["createFieldWrapper","fd","fieldWrapper","ids","generateFieldId","suffix","slug","toClassName","idSuffix","createLabel","label","setCommonAttributes","field","createHeading","level","heading","createPlaintext","text","createSelect","select","addOption","value","option","options","optionsUrl","opt","createConfirmation","form","createSubmit","button","createTextArea","createInput","createFieldset","legend","createToggle","toggleSwitch","slider","createCheckbox","createRadio","FIELD_CREATOR_FUNCTIONS","createField","type"],"mappings":"sCAEA,SAASA,EAAmBC,EAAI,CAC9B,MAAMC,EAAe,SAAS,cAAc,KAAK,EACjD,OAAID,EAAG,QAAOC,EAAa,UAAYD,EAAG,OAC1CC,EAAa,UAAU,IAAI,gBAAiB,GAAGD,EAAG,IAAI,UAAU,EAEhEC,EAAa,QAAQ,SAAWD,EAAG,SAE5BC,CACT,CAEA,MAAMC,EAAM,CAAE,EACd,SAASC,EAAgBH,EAAII,EAAS,GAAI,CACxC,MAAMC,EAAOC,EAAY,QAAQN,EAAG,IAAI,GAAGI,CAAM,EAAE,EACnDF,EAAIG,CAAI,EAAIH,EAAIG,CAAI,GAAK,EACzB,MAAME,EAAWL,EAAIG,CAAI,EAAI,IAAIH,EAAIG,CAAI,CAAC,GAAK,GAC/C,OAAAH,EAAIG,CAAI,GAAK,EACN,GAAGA,CAAI,GAAGE,CAAQ,EAC3B,CAEA,SAASC,EAAYR,EAAI,CACvB,MAAMS,EAAQ,SAAS,cAAc,OAAO,EAC5C,OAAAA,EAAM,GAAKN,EAAgBH,EAAI,QAAQ,EACvCS,EAAM,YAAcT,EAAG,OAASA,EAAG,KACnCS,EAAM,aAAa,MAAOT,EAAG,EAAE,GAC3BA,EAAG,UAAU,gBAAkB,QAAUA,EAAG,UAAU,YAAa,IAAK,OAC1ES,EAAM,QAAQ,SAAW,IAEpBA,CACT,CAEA,SAASC,EAAoBC,EAAOX,EAAI,CACtCW,EAAM,GAAKX,EAAG,GACdW,EAAM,KAAOX,EAAG,KAChBW,EAAM,SAAWX,EAAG,YAAcA,EAAG,UAAU,YAAa,IAAK,QAAUA,EAAG,UAAU,YAAW,IAAO,KAC1GW,EAAM,YAAcX,EAAG,YACvBW,EAAM,MAAQX,EAAG,KACnB,CAEA,MAAMY,EAAiBZ,GAAO,CAC5B,MAAMC,EAAeF,EAAmBC,CAAE,EAEpCa,EAAQb,EAAG,OAASA,EAAG,MAAM,SAAS,aAAa,EAAI,EAAI,EAC3Dc,EAAU,SAAS,cAAc,IAAID,CAAK,EAAE,EAClD,OAAAC,EAAQ,YAAcd,EAAG,OAASA,EAAG,MACrCc,EAAQ,GAAKd,EAAG,GAEhBC,EAAa,OAAOa,CAAO,EAEpB,CAAE,MAAOA,EAAS,aAAAb,CAAc,CACzC,EAEMc,EAAmBf,GAAO,CAC9B,MAAMC,EAAeF,EAAmBC,CAAE,EAEpCgB,EAAO,SAAS,cAAc,GAAG,EACvC,OAAAA,EAAK,YAAchB,EAAG,OAASA,EAAG,MAClCgB,EAAK,GAAKhB,EAAG,GAEbC,EAAa,OAAOe,CAAI,EAEjB,CAAE,MAAOA,EAAM,aAAAf,CAAc,CACtC,EAEMgB,EAAe,MAAOjB,GAAO,CACjC,MAAMkB,EAAS,SAAS,cAAc,QAAQ,EAC9CR,EAAoBQ,EAAQlB,CAAE,EAC9B,MAAMmB,EAAY,CAAC,CAAE,KAAAH,EAAM,MAAAI,CAAK,IAAO,CACrC,MAAMC,EAAS,SAAS,cAAc,QAAQ,EAC9C,OAAAA,EAAO,KAAOL,EAAK,KAAM,EACzBK,EAAO,MAAQD,EAAM,KAAM,EACvBC,EAAO,QAAUH,EAAO,OAC1BG,EAAO,aAAa,WAAY,EAAE,EAEpCH,EAAO,IAAIG,CAAM,EACVA,CACR,EAOD,GALIrB,EAAG,aACMmB,EAAU,CAAE,KAAMnB,EAAG,YAAa,MAAO,GAAI,EACrD,aAAa,WAAY,EAAE,EAG5BA,EAAG,QAAS,CACd,IAAIsB,EAAU,CAAE,EAChB,GAAItB,EAAG,QAAQ,WAAW,UAAU,EAAG,CACrC,MAAMuB,EAAa,IAAI,IAAIvB,EAAG,OAAO,GAExB,MADA,MAAM,MAAM,GAAGuB,EAAW,QAAQ,GAAGA,EAAW,MAAM,EAAE,GAC7C,KAAM,GACzB,KAAK,QAASC,GAAQ,CACzBF,EAAQ,KAAK,CACX,KAAME,EAAI,OACV,MAAOA,EAAI,OAASA,EAAI,MAClC,CAAS,CACT,CAAO,CACP,MACMF,EAAUtB,EAAG,QAAQ,MAAM,GAAG,EAAE,IAAKwB,IAAS,CAC5C,KAAMA,EAAI,KAAM,EAChB,MAAOA,EAAI,KAAM,EAAC,YAAa,CACvC,EAAQ,EAGJF,EAAQ,QAASE,GAAQL,EAAUK,CAAG,CAAC,CAC3C,CAEE,MAAMvB,EAAeF,EAAmBC,CAAE,EAC1C,OAAAC,EAAa,OAAOiB,CAAM,EAC1BjB,EAAa,QAAQO,EAAYR,CAAE,CAAC,EAE7B,CAAE,MAAOkB,EAAQ,aAAAjB,CAAc,CACxC,EAEMwB,EAAqB,CAACzB,EAAI0B,KAC9BA,EAAK,QAAQ,aAAe,IAAI,IAAI1B,EAAG,KAAK,EAAE,SAEvC,CAAE,GAGL2B,EAAgB3B,GAAO,CAC3B,MAAM4B,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,YAAc5B,EAAG,OAASA,EAAG,KACpC4B,EAAO,UAAU,IAAI,QAAQ,EAC7BA,EAAO,KAAO,SAEd,MAAM3B,EAAeF,EAAmBC,CAAE,EAC1C,OAAAC,EAAa,OAAO2B,CAAM,EACnB,CAAE,MAAOA,EAAQ,aAAA3B,CAAc,CACxC,EAEM4B,EAAkB7B,GAAO,CAC7B,MAAMW,EAAQ,SAAS,cAAc,UAAU,EAC/CD,EAAoBC,EAAOX,CAAE,EAE7B,MAAMC,EAAeF,EAAmBC,CAAE,EACpCS,EAAQD,EAAYR,CAAE,EAC5B,OAAAW,EAAM,aAAa,kBAAmBF,EAAM,EAAE,EAC9CR,EAAa,OAAOU,CAAK,EACzBV,EAAa,QAAQQ,CAAK,EAEnB,CAAE,MAAAE,EAAO,aAAAV,CAAc,CAChC,EAEM6B,EAAe9B,GAAO,CAC1B,MAAMW,EAAQ,SAAS,cAAc,OAAO,EAC5CA,EAAM,KAAOX,EAAG,KAChBU,EAAoBC,EAAOX,CAAE,EAE7B,MAAMC,EAAeF,EAAmBC,CAAE,EACpCS,EAAQD,EAAYR,CAAE,EAC5B,OAAAW,EAAM,aAAa,kBAAmBF,EAAM,EAAE,EAC9CR,EAAa,OAAOU,CAAK,EACrBX,EAAG,OAAS,SAAWA,EAAG,OAAS,WACrCC,EAAa,OAAOQ,CAAK,EAEzBR,EAAa,QAAQQ,CAAK,EAGrB,CAAE,MAAAE,EAAO,aAAAV,CAAc,CAChC,EAEM8B,EAAkB/B,GAAO,CAC7B,MAAMW,EAAQ,SAAS,cAAc,UAAU,EAG/C,GAFAD,EAAoBC,EAAOX,CAAE,EAEzBA,EAAG,MAAO,CACZ,MAAMgC,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,YAAchC,EAAG,MACxBW,EAAM,OAAOqB,CAAM,CACvB,CAEE,MAAM/B,EAAeF,EAAmBC,CAAE,EAC1C,OAAAC,EAAa,OAAOU,CAAK,EAElB,CAAE,MAAAA,EAAO,aAAAV,CAAc,CAChC,EAEMgC,EAAgBjC,GAAO,CAC3B,KAAM,CAAE,MAAAW,EAAO,aAAAV,GAAiB6B,EAAY9B,CAAE,EAC9CW,EAAM,KAAO,WACRA,EAAM,QAAOA,EAAM,MAAQ,MAChCA,EAAM,UAAU,IAAI,QAAQ,EAC5BV,EAAa,UAAU,IAAI,mBAAmB,EAE9C,MAAMiC,EAAe,SAAS,cAAc,KAAK,EACjDA,EAAa,UAAU,IAAI,QAAQ,EACnCA,EAAa,OAAOvB,CAAK,EACzBV,EAAa,OAAOiC,CAAY,EAEhC,MAAMC,EAAS,SAAS,cAAc,MAAM,EAC5C,OAAAA,EAAO,UAAU,IAAI,QAAQ,EAC7BD,EAAa,OAAOC,CAAM,EAC1BA,EAAO,iBAAiB,QAAS,IAAM,CACrCxB,EAAM,QAAU,CAACA,EAAM,OAC3B,CAAG,EAEM,CAAE,MAAAA,EAAO,aAAAV,CAAc,CAChC,EAEMmC,EAAkBpC,GAAO,CAC7B,KAAM,CAAE,MAAAW,EAAO,aAAAV,GAAiB6B,EAAY9B,CAAE,EAC9C,OAAKW,EAAM,QAAOA,EAAM,MAAQ,WAChCV,EAAa,UAAU,IAAI,mBAAmB,EAEvC,CAAE,MAAAU,EAAO,aAAAV,CAAc,CAChC,EAEMoC,EAAerC,GAAO,CAC1B,KAAM,CAAE,MAAAW,EAAO,aAAAV,GAAiB6B,EAAY9B,CAAE,EAC9C,OAAKW,EAAM,QAAOA,EAAM,MAAQX,EAAG,OAAS,MAC5CC,EAAa,UAAU,IAAI,mBAAmB,EAEvC,CAAE,MAAAU,EAAO,aAAAV,CAAc,CAChC,EAEMqC,EAA0B,CAC9B,OAAQrB,EACR,QAASL,EACT,UAAWG,EACX,YAAac,EACb,OAAQI,EACR,OAAQN,EACR,aAAcF,EACd,SAAUM,EACV,SAAUK,EACV,MAAOC,CACT,EAEe,eAAeE,EAAYvC,EAAI0B,EAAM,CAClD1B,EAAG,GAAKA,EAAG,IAAMG,EAAgBH,CAAE,EACnC,MAAMwC,EAAOxC,EAAG,KAAK,YAAa,EAIlC,OAFsB,MADEsC,EAAwBE,CAAI,GAAKV,GACb9B,EAAI0B,CAAI,GAE/B,YACvB"}